<!DOCTYPE html>
<html lang="ja">
<head>
        <meta charset="utf-8" />
        <title>vimscriptについて</title>
        <link rel="stylesheet" href="http://float1251.github.io/blog/theme/css/main.css" />
        <link href="http://float1251.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="float's memo Atom Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://float1251.github.io/blog/">float's memo </a></h1>
                <nav><ul>
                    <li class="active"><a href="http://float1251.github.io/blog/category/articles.html">articles</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="http://float1251.github.io/blog/articles/2014/05/vimscript.html" rel="bookmark"
           title="Permalink to vimscriptについて">vimscriptについて</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-05-11T00:00:00+09:00">
                Published: 日 11 5月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://float1251.github.io/blog/author/float1251.html">float1251</a>
        </address>
<p>In <a href="http://float1251.github.io/blog/category/articles.html">articles</a>. </p>

</footer><!-- /.post-info -->      <p>vim pluginを開発したいと考えているが、まずはvimscriptについて知らないといけない。</p>
<p>ということでちょっと調べてみた。</p>
<p><a class="reference external" href="http://mattn.kaoriya.net/software/vim/20111202085236.htm">http://mattn.kaoriya.net/software/vim/20111202085236.htm</a></p>
<p>この記事が素晴らしすぎたので、こっちを読むとよいと思います。</p>
<p>あとこことか</p>
<p><a class="reference external" href="http://vim-users.jp/2010/04/hack136/">http://vim-users.jp/2010/04/hack136/</a>
<a class="reference external" href="http://vim-jp.org/tips/start_vimscript.html">http://vim-jp.org/tips/start_vimscript.html</a></p>
<p>とりあえず、備忘録的にやったことを残しておこうと思います。</p>
<div class="section" id="id1">
<h2>変数宣言</h2>
<p>こんな感じ。</p>
<div class="highlight"><pre><span class="c">&quot; 数値</span>
<span class="k">let</span> foo <span class="p">=</span> <span class="m">1</span>
<span class="c">&quot; 文字列</span>
<span class="k">let</span> foo <span class="p">=</span> <span class="s2">&quot;bar&quot;</span>
<span class="c">&quot; リスト</span>
<span class="k">let</span> foo <span class="p">=</span> [<span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span>]
<span class="c">&quot; 辞書</span>
<span class="k">let</span> foo <span class="p">=</span> {<span class="s2">&quot;bar&quot;</span>: <span class="s2">&quot;bar&quot;</span>}
</pre></div>
</div>
<div class="section" id="id2">
<h2>関数定義</h2>
<p>こんな感じ。</p>
<div class="highlight"><pre><span class="k">function</span> Foo<span class="p">()</span>
    echo <span class="s2">&quot;foo&quot;</span>
<span class="k">endfunction</span>
</pre></div>
<p>コマンドラインから実行すると以下のようになる。</p>
<div class="highlight"><pre><span class="p">:</span><span class="k">call</span> Foo<span class="p">()</span>
foo
</pre></div>
<p>同じ関数名を定義するにはfunction!を指定する</p>
<div class="highlight"><pre><span class="k">function</span><span class="p">!</span> Foo<span class="p">()</span>
    echo <span class="s2">&quot;foo&quot;</span>
<span class="k">endfunction</span>
</pre></div>
</div>
<div class="section" id="id3">
<h2>スコープ</h2>
<p>関数内で有効なローカルスコープ l:、スクリプトファイル内で有効なスコープ s:、グローバルで有効なスコープ、
がよく使う。</p>
<p>こんな感じ。</p>
<div class="highlight"><pre><span class="k">function</span><span class="p">!</span> s:Foo<span class="p">()</span>
    <span class="k">let</span> <span class="k">l</span>:foo <span class="p">=</span> <span class="s2">&quot;foo&quot;</span>
    echo foo
<span class="k">endfunction</span>
<span class="k">call</span> s:Foo<span class="p">()</span>
</pre></div>
</div>
<div class="section" id="python">
<h2>Pythonインターフェース</h2>
<p>vimscriptではPythonを使用することが出来ます。</p>
<p>まずは使用できるかどうかの確認。</p>
<div class="highlight"><pre>echo has<span class="p">(</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>
<span class="m">1</span>

echo has<span class="p">(</span><span class="s2">&quot;python3&quot;</span><span class="p">)</span>
<span class="m">1</span>
</pre></div>
<p>であればpython2もpython3も両方使えます。</p>
<p>ではvimscriptで実際にpythonを使用してみます。</p>
<div class="highlight"><pre><span class="k">function</span><span class="p">!</span> s:Foo<span class="p">()</span>
    <span class="k">python3</span> <span class="p">&lt;&lt;</span> EOM
print<span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
EOM
<span class="k">endfunction</span>

<span class="k">call</span> s:Foo<span class="p">()</span>
</pre></div>
<p>このような形で使用します。</p>
<p>外部ファイルを実行する際は:pyfileコマンドを使用します。</p>
</div>
<div class="section" id="map">
<h2>map</h2>
<p>基本的なコマンドについては知っているので割愛。</p>
<p>インサートモードにおいて、関数の評価結果から入力文字列を挿入させるためには&lt;expr&gt;を使用する。</p>
<div class="highlight"><pre><span class="nb">inoremap</span> <span class="p">&lt;</span>expr<span class="p">&gt;</span> <span class="p">&lt;</span><span class="k">c</span><span class="p">-</span><span class="k">x</span><span class="p">&gt;</span> Foo<span class="p">()</span>
</pre></div>
</div>
<div class="section" id="command">
<h2>command</h2>
<p>コマンドモードから実行できるコマンドを定義する。</p>
<p>名前の戦闘は大文字である必要がある。</p>
<div class="highlight"><pre>command<span class="p">!</span> Foo :<span class="k">call</span> Foo<span class="p">()</span>
</pre></div>
<p>詳しくは help :command-args を参照。</p>
</div>
<div class="section" id="autoloadautocmd">
<h2>autoloadとautocmd</h2>
<p><a class="reference external" href="http://mattn.kaoriya.net/software/vim/20111202085236.htm">http://mattn.kaoriya.net/software/vim/20111202085236.htm</a></p>
<p>ここ見たほうがよいです。</p>
</div>
<div class="section" id="id4">
<h2>vimscriptの組み込み関数</h2>
<p>機能別に分類してあるヘルプは以下で見れる。</p>
<div class="highlight"><pre><span class="p">:</span>help <span class="k">function</span><span class="p">-</span><span class="nb">list</span>
</pre></div>
<p>アルファベット順は以下</p>
<div class="highlight"><pre><span class="p">:</span>help functions
</pre></div>
<p>ということで最後の方はだいぶ適当になったけど、これで最低限vimscriptが読めるようになった気がします。</p>
<p>あとは色々見たり作ったりしながら覚えていこうかと思います。</p>
</div>

    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://float1251.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://twitter.com/float1251">twitter</a></li>
                            <li><a href="https://github.com/float1251">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>