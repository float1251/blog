<!DOCTYPE html>
<html lang="ja">
  <head>
        <meta charset="utf-8" />
    <title>vimscriptについて — float's memo</title>
    <link rel="stylesheet" type="text/css" href="http://float1251.github.io/blog/theme/css/skeleton.css" />
    <link rel="stylesheet" type="text/css" href="http://float1251.github.io/blog/theme/css/main.css" />
    <link rel="shortcut icon" type="text/css" href="http://float1251.github.io/blog/favicon.ico" />
    <link rel="alternate" type="application/atom+xml"
                           title="float's memo — Flux Atom"
                           href="http://float1251.github.io/blog/" /> 
    <!--[if lte IE 8]><script src="http://float1251.github.io/blog/theme/js/html5shiv.js"></script><![endif]-->
    <meta name="viewport" content="initial-scale=1.0, width=device-width, user-scalable=no" />

    <meta name="author"   content="float1251" />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div class="page">
      <header class="page-head">
        <h1>
          <a href="http://float1251.github.io/blog/index.html">float's memo</a>
        </h1>
      </header>

      <div class="page-content">
     <article class="post content">
      <header class="post-header">
        <time datetime="2014-05-11T00:00:00+09:00" pubdate="pubdate">
          日 11 5月 2014
        </time>
        <h1>
          <a rel="bookmark"
             href="http://float1251.github.io/blog/articles/2014/05/vimscript.html"
             title="Lien permanent vers «vimscriptについて»">
             vimscriptについて
          </a>
        </h1>
        <div class="meta">
            Dans «<a href="http://float1251.github.io/blog/category/articles.html">articles</a>» 
            par <a href="http://float1251.github.io/blog/author/float1251.html">float1251</a>
        </div>
      </header>
      <div class="post-content"> 
        <p>vim pluginを開発したいと考えているが、まずはvimscriptについて知らないといけない。</p>
<p>ということでちょっと調べてみた。</p>
<p><a class="reference external" href="http://mattn.kaoriya.net/software/vim/20111202085236.htm">http://mattn.kaoriya.net/software/vim/20111202085236.htm</a></p>
<p>この記事が素晴らしすぎたので、こっちを読むとよいと思います。</p>
<p>あとこことか</p>
<p><a class="reference external" href="http://vim-users.jp/2010/04/hack136/">http://vim-users.jp/2010/04/hack136/</a>
<a class="reference external" href="http://vim-jp.org/tips/start_vimscript.html">http://vim-jp.org/tips/start_vimscript.html</a></p>
<p>とりあえず、備忘録的にやったことを残しておこうと思います。</p>
<div class="section" id="id1">
<h2>変数宣言</h2>
<p>こんな感じ。</p>
<div class="highlight"><pre><span class="c">&quot; 数値</span>
<span class="k">let</span> foo <span class="p">=</span> <span class="m">1</span>
<span class="c">&quot; 文字列</span>
<span class="k">let</span> foo <span class="p">=</span> <span class="s2">&quot;bar&quot;</span>
<span class="c">&quot; リスト</span>
<span class="k">let</span> foo <span class="p">=</span> [<span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span>]
<span class="c">&quot; 辞書</span>
<span class="k">let</span> foo <span class="p">=</span> {<span class="s2">&quot;bar&quot;</span>: <span class="s2">&quot;bar&quot;</span>}
</pre></div>
</div>
<div class="section" id="id2">
<h2>関数定義</h2>
<p>こんな感じ。</p>
<div class="highlight"><pre><span class="k">function</span> Foo<span class="p">()</span>
    echo <span class="s2">&quot;foo&quot;</span>
<span class="k">endfunction</span>
</pre></div>
<p>コマンドラインから実行すると以下のようになる。</p>
<div class="highlight"><pre><span class="p">:</span><span class="k">call</span> Foo<span class="p">()</span>
foo
</pre></div>
<p>同じ関数名を定義するにはfunction!を指定する</p>
<div class="highlight"><pre><span class="k">function</span><span class="p">!</span> Foo<span class="p">()</span>
    echo <span class="s2">&quot;foo&quot;</span>
<span class="k">endfunction</span>
</pre></div>
</div>
<div class="section" id="id3">
<h2>スコープ</h2>
<p>関数内で有効なローカルスコープ l:、スクリプトファイル内で有効なスコープ s:、グローバルで有効なスコープ、
がよく使う。</p>
<p>こんな感じ。</p>
<div class="highlight"><pre><span class="k">function</span><span class="p">!</span> s:Foo<span class="p">()</span>
    <span class="k">let</span> <span class="k">l</span>:foo <span class="p">=</span> <span class="s2">&quot;foo&quot;</span>
    echo foo
<span class="k">endfunction</span>
<span class="k">call</span> s:Foo<span class="p">()</span>
</pre></div>
</div>
<div class="section" id="python">
<h2>Pythonインターフェース</h2>
<p>vimscriptではPythonを使用することが出来ます。</p>
<p>まずは使用できるかどうかの確認。</p>
<div class="highlight"><pre>echo has<span class="p">(</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>
<span class="m">1</span>

echo has<span class="p">(</span><span class="s2">&quot;python3&quot;</span><span class="p">)</span>
<span class="m">1</span>
</pre></div>
<p>であればpython2もpython3も両方使えます。</p>
<p>ではvimscriptで実際にpythonを使用してみます。</p>
<div class="highlight"><pre><span class="k">function</span><span class="p">!</span> s:Foo<span class="p">()</span>
    <span class="k">python3</span> <span class="p">&lt;&lt;</span> EOM
print<span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
EOM
<span class="k">endfunction</span>

<span class="k">call</span> s:Foo<span class="p">()</span>
</pre></div>
<p>このような形で使用します。</p>
<p>外部ファイルを実行する際は:pyfileコマンドを使用します。</p>
</div>
<div class="section" id="map">
<h2>map</h2>
<p>基本的なコマンドについては知っているので割愛。</p>
<p>インサートモードにおいて、関数の評価結果から入力文字列を挿入させるためには&lt;expr&gt;を使用する。</p>
<div class="highlight"><pre><span class="nb">inoremap</span> <span class="p">&lt;</span>expr<span class="p">&gt;</span> <span class="p">&lt;</span><span class="k">c</span><span class="p">-</span><span class="k">x</span><span class="p">&gt;</span> Foo<span class="p">()</span>
</pre></div>
</div>
<div class="section" id="command">
<h2>command</h2>
<p>コマンドモードから実行できるコマンドを定義する。</p>
<p>名前の戦闘は大文字である必要がある。</p>
<div class="highlight"><pre>command<span class="p">!</span> Foo :<span class="k">call</span> Foo<span class="p">()</span>
</pre></div>
<p>詳しくは help :command-args を参照。</p>
</div>
<div class="section" id="autoloadautocmd">
<h2>autoloadとautocmd</h2>
<p><a class="reference external" href="http://mattn.kaoriya.net/software/vim/20111202085236.htm">http://mattn.kaoriya.net/software/vim/20111202085236.htm</a></p>
<p>ここ見たほうがよいです。</p>
</div>
<div class="section" id="id4">
<h2>vimscriptの組み込み関数</h2>
<p>機能別に分類してあるヘルプは以下で見れる。</p>
<div class="highlight"><pre><span class="p">:</span>help <span class="k">function</span><span class="p">-</span><span class="nb">list</span>
</pre></div>
<p>アルファベット順は以下</p>
<div class="highlight"><pre><span class="p">:</span>help functions
</pre></div>
<p>ということで最後の方はだいぶ適当になったけど、これで最低限vimscriptが読めるようになった気がします。</p>
<p>あとは色々見たり作ったりしながら覚えていこうかと思います。</p>
</div>

      </div>
      <footer class="post-footer">
        <div class="meta">
            Posté dans «<a href="http://float1251.github.io/blog/category/articles.html">articles</a>» 
            par <a href="http://float1251.github.io/blog/author/float1251.html">float1251</a><br />
            Mots-clés:         </div>
      </footer>
    </article>
      </div>
    <aside class="page-sidebar">
      <nav class="widget">
      <h3>Site</h3>
        <ul>
          <li><a href="http://float1251.github.io/blog">Accueil</a></li>
          <li><a href="http://float1251.github.io/blog/archives.html">Archives</a></li>
          <li><a href="http://float1251.github.io/blog/tags.html">Mots-clés</a></li>
        </ul>
      </nav>

      <nav class="widget">
        <h3>Catégories</h3>
        <ul>
          <li><a href="http://float1251.github.io/blog/category/articles.html">articles</a></li>
        </ul>
      </nav>

      <nav class="widget">
        <h3>Social</h3>
        <ul>
          <li><a href="twitter">https://twitter.com/float1251</a></li>
          <li><a href="github">https://github.com/float1251</a></li>
          <li><a href="http://float1251.github.io/blog/" rel="alternate">Flux Atom</a></li>
        </ul>
      </nav>
    </aside> 

      <footer class="page-footer">
        <p> Powered by <a href="http://pelican.readthedocs.org">Pelican</a></p>
      </footer>
    </div>
  </body>
</html>